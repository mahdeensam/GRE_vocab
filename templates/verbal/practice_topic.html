<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ topic.title }} â€” GRE Verbal Practice</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='verbal-practice.css') }}">
</head>
<body>
  <!-- Mobile menu toggle -->
  <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">&#9776;</button>

  <!-- Sidebar nav -->
  <nav class="sidebar" id="sidebar">
    <a href="{{ url_for('landing') }}" class="sidebar-home" style="font-size:.85rem;opacity:.75;">&#8592; Back to Home</a>
    <a href="{{ url_for('verbal_practice_index') }}" class="sidebar-home">&#8592; Verbal Practice</a>

    {% for cat in categories %}
    {% set is_current_cat = topic.category == cat.id %}
    <div class="sidebar-group {% if is_current_cat %}open{% endif %}">
      <button class="sidebar-cat" onclick="toggleSidebarGroup(this)">
        <span class="sidebar-cat-icon">{{ cat.icon }}</span>
        <span class="sidebar-cat-name">{{ cat.name }}</span>
        <span class="sidebar-chevron">&#8250;</span>
      </button>
      <div class="sidebar-items">
        {% for t in topics if t.category == cat.id %}
        <a href="{{ url_for('verbal_practice_topic', topic_id=t.id) }}"
           class="sidebar-link {% if t.id == topic.id %}active{% endif %}">
          <span class="sidebar-icon">{{ t.icon }}</span> {{ t.title }}
        </a>
        {% endfor %}
      </div>
    </div>
    {% endfor %}

    <a href="{{ url_for('verbal_practice_assessment') }}" class="sidebar-link sidebar-link-assessment">
      <span class="sidebar-icon" style="background:rgba(56,189,248,.15);color:#38bdf8;">&#9733;</span> What I Know
    </a>
  </nav>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleMobileMenu()"></div>

  <main class="content">
    <!-- Breadcrumb -->
    {% for cat in categories if cat.id == topic.category %}
    <nav class="breadcrumb">
      <a href="{{ url_for('verbal_practice_index') }}">Home</a>
      <span class="breadcrumb-sep">&#8250;</span>
      <a href="{{ url_for('verbal_practice_index') }}#{{ cat.id }}">{{ cat.name }}</a>
      <span class="breadcrumb-sep">&#8250;</span>
      <span class="breadcrumb-current">{{ topic.title }}</span>
    </nav>
    {% endfor %}

    <header class="topic-header">
      <h1><span class="topic-badge">{{ topic.icon }}</span> {{ topic.title }}</h1>
      {% set ns = namespace(count=0) %}
      {% for s in topic.sections %}
        {% set ns.count = ns.count + s.questions|length %}
      {% endfor %}
      <p class="topic-meta">{{ ns.count }} questions across {{ topic.sections|length }} sections</p>
    </header>

    {% set si = namespace(idx=0) %}
    {% for section in topic.sections %}
    <section class="question-section">
      <h2 class="section-title">
        {{ section.type }}
        {% if section.get('multi_select', False) %}
        <span class="se-badge">Pick 2</span>
        {% endif %}
      </h2>
      <p class="section-instructions">{{ section.instructions|safe }}</p>

      {# RC Passage display #}
      {% if section.get('passage', '') %}
      <div class="passage-box">
        <div class="passage-label">Passage</div>
        {{ section.passage }}
      </div>
      {% endif %}

      {% for q in section.questions %}
      {% set qkey = topic.id ~ '_' ~ si.idx ~ '_' ~ q.id %}
      <div class="question-card" id="q{{ q.id }}">
        <button class="fav-btn" data-qkey="{{ qkey }}" onclick="toggleFav('{{ qkey }}')" title="Toggle favorite">&#9829;</button>
        <button class="learned-btn" data-qkey="{{ qkey }}" onclick="toggleLearned('{{ qkey }}')" title="Mark as learned">&#10003;</button>
        <div class="q-number">Q{{ q.id }}</div>
        <div class="q-body">
          {% if q.stem %}
          <div class="q-stem">{{ q.stem|safe }}</div>
          {% endif %}

          {# Multi-blank choices (TC 2-blank, 3-blank) #}
          {% if q.get('blank_choices') %}
          {% set num_blanks = q.blank_choices|length %}
          <div class="blank-choices-container cols-{{ num_blanks }}">
            {% for group in q.blank_choices %}
            <div class="blank-group">
              <div class="blank-group-label">Blank ({{ ['i', 'ii', 'iii'][loop.index0] }})</div>
              <ul>
                {% for c in group %}
                <li>{{ c }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          {# Regular choices (TC 1-blank, SE, RC) #}
          {% if q.get('choices') %}
          <ul class="choices">
            {% for c in q.choices %}
            <li>{{ c }}</li>
            {% endfor %}
          </ul>
          {% endif %}

          {# Answer reveal #}
          {% if q.get('answer') %}
          <button class="reveal-btn" onclick="toggleAnswer('{{ qkey }}')">Show Answer</button>
          <div class="answer-box" id="ans-{{ qkey }}">
            <div class="answer-text">Answer: {{ q.answer }}</div>
            {% if q.get('explanation') %}
            <div class="explanation-text">{{ q.explanation }}</div>
            {% endif %}
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </section>
    {% set si.idx = si.idx + 1 %}
    {% endfor %}
  </main>

  <footer>
    <div class="container">
      <p>GRE Verbal Practice &mdash; High-band difficulty questions.</p>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='verbal-practice.js') }}"></script>
</body>
</html>
